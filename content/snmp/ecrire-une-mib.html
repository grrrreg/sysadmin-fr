<div class="content">
      <p>Cet article a pour objectif de décrire l'écriture d'une (toute) petite MIB, permettant de décrire des traps SNMP. Attention, cet article n'a pas la prétention d'expliquer les best-practices des MIBs, néamoins, au vu de l'absence de documentation, l'article peut servir de point de départ. </p>
<p>Tout d'abord, il est recommander de disposer d'un numéro d'OID enterprise (qui peut s'obtenir gratuitement auprès de l'IANA). </p>
<p>Dans un premier temps, exécuter votre éditeur texte préférer pour créer un fichier nommé LINAGORA-MIB.txt, et y créer le contenu suivant :</p>
<p>En première ligne, on déclare une nouvelle MIB, nommée LINAGORA-MIB :</p>
<p><code><br />
LINAGORA-MIB   DEFINITIONS ::= BEGIN<br />
</code></p>
<p>Ensuite, on effectue quelques imports, permettant d'utiliser des définitions :</p>
<p><code><br />
IMPORTS<br />
    OBJECT-TYPE, NOTIFICATION-TYPE, MODULE-IDENTITY,<br />
    Integer32, Opaque, enterprises, Counter32<br />
        FROM SNMPv2-SMI<br />
    TEXTUAL-CONVENTION, DisplayString, TruthValue<br />
   FROM SNMPv2-TC;<br />
</code></p>
<p>La section suivante est l'une des plus importante, elle permet d'associée notre MIB à notre numéro d'OID enterprise (ici le numéro 10943, attribuée à l'enterprise Linagora), et d'apporter quelques informations sur la MIB :</p>
<p><code><br />
linagora MODULE-IDENTITY<br />
    LAST-UPDATED "200712170000Z"<br />
    ORGANIZATION "Groupe Linagora http://www.linagora.com/"<br />
    CONTACT-INFO<br />
   "email:  bbonfils@linagora.com"<br />
    DESCRIPTION<br />
   "LINAGORA MIB"<br />
    ::= { enterprises 10943 }<br />
</code></p>
<p>Il est à noter que dans cette déclaration, nous pouvons introduire différentes informations, comme un CONTACT-INFO, LAST-UPDATED, etc. Néanmoins, les lignes les plus importantes sont les suivantes :</p>
<p><code><br />
linagora MODULE-IDENTITY<br />
    ::= { enterprises 10943 }<br />
</code></p>
<p>Cela permet d'associer le numéro 1.3.6.1.4.1.10943 au nom enterprises::linagora.</p>
<p>Nous voici maintenant au coeur de notre MIB. Avant tout, un peu de contexte : j'ai écris cette MIB pour utiliser avec un script qui renvoie des trap snmp, de la forme 1.3.6.1.4.1.10943.2.1.x. J'ai réserver la branche 10943.2 pour l'application (EJBCA) que le script supervise, et la sous-branche (10943.2).1 pour y décrire les messages d'erreurs, cela se traduit de la manière suivante :</p>
<p><code><br />
ejbca OBJECT IDENTIFIER ::= { linagora 2 }<br />
error OBJECT IDENTIFIER ::= { ejbca 1 }<br />
</code></p>
<p>La première definis une sous branche, nommé EJBCA, avec la valeur 2, qui elle-même est une sous branche de mon OID enterprise. De la même manière, on crée une branche error en dessous de la branche ejbca. </p>
<p>Maintenant, on décrit un ensemble de noeuds :</p>
<p><code><br />
addEntityError OBJECT IDENTIFIER ::= { error 1 }<br />
setPasswordError OBJECT IDENTIFIER ::= { error 2 }<br />
createPKCS12Error OBJECT IDENTIFIER ::= { error 3 }<br />
invalidPKCS12Error OBJECT IDENTIFIER ::= { error 4 }<br />
createCRLError OBJECT IDENTIFIER ::= { error 5 }<br />
getCRLError OBJECT IDENTIFIER ::= { error 6 }<br />
checkCRLError OBJECT IDENTIFIER ::= { error 7 }<br />
nextdateCRLError OBJECT IDENTIFIER ::= { error 8 }<br />
</code></p>
<p>Et on n'oublie pas de terminer notre fichier avec :</p>
<p><code><br />
END<br />
</code></p>
<p>Maintenant, lorsque de l'envoie d'une trap SNMP à l'aide de la commande suivante :</p>
<p><code><br />
# snmptrap -v2c -c xxxx hostname '' 1.3.6.1.4.1.10943.2 1.3.6.1.4.1.10943.2.1.1 s 'entity already exists'<br />
</code></p>
<p>On obtiendra le message suivant du coté de l'agent SNMP :</p>
<p><code><br />
Jan 28 10:02:09 hostname snmptrapd[10289]: 2008-01-28 10:02:09  [UDP: [xx.xx.xx.xx]:50998]: DISMAN-EVENT-MIB::sysUpTimeInstance = Timeticks: (921267323) 106 days, 15:04:33.23^ISNMPv2-MIB::snmpTrapOID.0 = OID: LINAGORA-MIB::ejbca^ILINAGORA-MIB::addEntityError = STRING: "entity already exists"<br />
</code></p>
<table id="attachments" class="sticky-enabled">
 <thead><tr><th>Fichier attaché</th><th>Taille</th> </tr></thead>
<tbody>
 <tr class="odd"><td><a href="http://www.sysadmin-fr.org/files/LINAGORA-MIB.txt">LINAGORA-MIB.txt</a></td><td>995 octets</td> </tr>
</tbody>
</table>
    </div>
<div class="content">
      </div>
<div class="content">
    <ul><li class="en first"><a href="/en/snmp/ecrire-une-mib" class="language-link">English</a></li>
<li class="fr last active"><a href="/fr/snmp/ecrire-une-mib" class="language-link active">French</a></li>
</ul>  </div>
