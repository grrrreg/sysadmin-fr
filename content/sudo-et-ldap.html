
      <h2>Introduction</h2>
<p>Vous connaissez déjà sans doute sudo, un outil permettant d'autoriser des utilisateurs à exécuter des commandes sous un autre utilisateur (par exemple root) sans connaître le mot de passe ce celui-ci. Nous vos proposons à travers cet article d'utiliser un annuaire LDAP pour stocker votre configuration sudo. Cela à le gros avantage de centraliser la configuration, et donc une administration simplifiée.</p>
<h2>La configuration standard</h2>
<p>Voici un fichier de configuration classique de sudo :</p>
<p><code>root  ALL=(ALL) ALL<br />
%operator   ALL=(ALL) ALL</code></p>
<p>Ce fichier de configuration est volontairement très simple pour une première approche. Il autorise l'utilisateur <em>root</em> et les membres du groupe <em>operator</em> à exécuter des commandes sous n'importe quel utilisateur. Un appel à la commande <b>sudo -l</b> permet d'obtenir la liste des règles autorisées par l'utilisateur appelant&nbsp;:</p>
<p><code>% id -a<br />
uid=1000(asyd) gid=1000(asyd) groupes=4(adm),37(operator),1000(asyd)<br />
% sudo -l<br />
User asyd may run the following commands on this host:<br />
    (ALL) ALL</code>
</p>
<h2>Installation</h2>
<p>Avant tout, vous devez vérifier que le sudo que vous utilisez est compilé avec le support ldap, pour cela vérifier que votre binaire sudo est <em>linké</em> sur la libldap&nbsp;</p>
<p><code>% ldd sudo | grep ldap<br />
   libldap.so.5 =>  /usr/lib/libldap.so.5</code></p>
<p>Si vous n'obtenez aucun résultat, vous devez recompiler sudo avec l'option <em>--with-ldap</em></p>
<h2>Configuration</h2>
<p>Vous disposez donc maintenant d'un sudo compilé avec le support LDAP, la première opération consiste à rajouter le schéma dans votre annulaire LDAP</p>
<h3>Installation du schéma LDAP</h3>
<h4>IPlanet, Sun Directory Server Entreprise Edition, OpenDS</h4>
<p>Pour rajouter le schéma, exécuter simplement la commande suivante (depuis le répertoire sources de sudo)&nbsp;:</p>
<p><code>% cp schema.iPlanet $INSTANCE_ROOT/config/schema/98-sudo.ldif</code></p>
<p>(Rajouter les options <em>-Wx</em> si vous utilisez un <em>ldapmodify</em> d'OpenLDAP.)
</p>
<h4>OpenLDAP</h4>
<p>Pour un annuaire OpenLDAP, copier le fichier <em>schema.OpenLDAP</em> dans le répertoire des schémas sous le nom <em>sudo.schema</em>, puis rajouter la ligne de configuration suivante dans le fichier <em>slapd.conf</em>&nbsp;:</p>
<p><code>schema sudo.schema</code></p>
<h3>Fichier de configuration</h3>
<p>Le fichier <em>sudoers</em> n'est plus nécessaire, les informations nécessaires sur le serveur LDAP sont stockés dans le fichier de configuration <em>ldap.conf</em>. Attention l'emplacement de ce fichier est spécifique à chaque distribution et système d'exploitation&nbsp;!</p>
<p>Voici un exemple très simple des directives nécessaires pour sudo&nbsp;:</p>
<p><code>host ldap.domain.tld<br />
port 389<br />
sudoers_base ou=sudo,ou=Apps,dc=asyd,dc=net</code>
</p>
<h3>Les objets LDAP</h3>
<p>Il nous reste maintenant à configurer les différents objets LDAP. Avant tout, il convient de préciser que l'approche de configuration LDAP est différente par rapport à l'utilisation de fichiers.</p>
